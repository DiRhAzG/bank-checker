///<reference path="/runeappslib.js"/>
///<reference path="/a1lib.js"/>
///<reference path="/imagedata.js"/>
///<reference path="/imagelibs/ocr.js"/>
"use strict";
//TODO this is broken move to js ocr
//===== this file is currently broken on alt1 1.5.3, i moved over to the typescript version of this file
if (window.alt1) {
	qw("largefont add", alt1.addOCRFont("largefont", '{"points":[{"x":1,"y":9},{"x":2,"y":6},{"x":2,"y":7},{"x":3,"y":4},{"x":3,"y":6},{"x":4,"y":1},{"x":4,"y":6},{"x":5,"y":0},{"x":5,"y":1},{"x":5,"y":6},{"x":6,"y":3},{"x":6,"y":4},{"x":6,"y":6},{"x":7,"y":6},{"x":7,"y":7},{"x":8,"y":9},{"x":1,"y":0},{"x":1,"y":1},{"x":1,"y":2},{"x":1,"y":3},{"x":1,"y":4},{"x":1,"y":5},{"x":1,"y":6},{"x":1,"y":7},{"x":1,"y":8},{"x":2,"y":0},{"x":2,"y":5},{"x":2,"y":9},{"x":3,"y":0},{"x":3,"y":5},{"x":3,"y":9},{"x":4,"y":0},{"x":4,"y":5},{"x":4,"y":9},{"x":5,"y":5},{"x":6,"y":1},{"x":6,"y":2},{"x":6,"y":7},{"x":6,"y":8},{"x":5,"y":9},{"x":6,"y":0},{"x":6,"y":9},{"x":8,"y":1},{"x":8,"y":8},{"x":7,"y":1},{"x":7,"y":8},{"x":8,"y":3},{"x":8,"y":4},{"x":8,"y":5},{"x":8,"y":6},{"x":2,"y":8},{"x":7,"y":5},{"x":8,"y":7},{"x":6,"y":5},{"x":7,"y":0},{"x":7,"y":2},{"x":7,"y":3},{"x":7,"y":4},{"x":7,"y":9},{"x":2,"y":1},{"x":2,"y":2},{"x":2,"y":3},{"x":2,"y":4},{"x":4,"y":4},{"x":5,"y":2},{"x":5,"y":7},{"x":3,"y":3},{"x":8,"y":0},{"x":8,"y":2},{"x":9,"y":7},{"x":9,"y":8},{"x":9,"y":9},{"x":9,"y":3},{"x":9,"y":4},{"x":9,"y":5},{"x":5,"y":8},{"x":4,"y":2},{"x":4,"y":3},{"x":4,"y":7},{"x":4,"y":8},{"x":3,"y":7},{"x":3,"y":8},{"x":5,"y":3},{"x":5,"y":4},{"x":10,"y":3},{"x":10,"y":4},{"x":11,"y":0},{"x":2,"y":12},{"x":3,"y":12},{"x":5,"y":10},{"x":0,"y":12},{"x":1,"y":12},{"x":2,"y":10},{"x":2,"y":11},{"x":10,"y":5},{"x":10,"y":6},{"x":10,"y":7},{"x":10,"y":8},{"x":10,"y":9},{"x":1,"y":10},{"x":1,"y":11},{"x":6,"y":10},{"x":6,"y":11},{"x":0,"y":3},{"x":9,"y":6},{"x":3,"y":11},{"x":3,"y":1},{"x":3,"y":2}],"chars":[{"width":10,"chr":"A","pixelcount":16,"secondary":false,"pixels":[29,58,0,0,0,0,0,29,0,0,29,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"B","pixelcount":27,"secondary":false,"pixels":[0,255,255,255,255,255,255,58,255,255,0,255,29,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,29,0,0,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":10,"chr":"C","pixelcount":12,"secondary":false,"pixels":[255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,0,0,29,255,255,255,255,255,255,255,255,58,255,58,255,255,255,255,255,0,29,29,58,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":10,"chr":"D","pixelcount":24,"secondary":false,"pixels":[0,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,255,0,0,255,0,0,255,0,255,255,255,255,255,29,255,255,255,255,58,58,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"E","pixelcount":21,"secondary":false,"pixels":[0,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":7,"chr":"F","pixelcount":17,"secondary":false,"pixels":[0,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,255,0,0,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":10,"chr":"G","pixelcount":17,"secondary":false,"pixels":[255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,0,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,0,255,0,255,255,255,255,255,0,29,255,255,0,255,29,255,255,0,0,58,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"H","pixelcount":25,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,0,0,0,0,0,0,0,0,0,255,0,255,255,0,255,255,0,255,0,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,0,255,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":5,"chr":"I","pixelcount":14,"secondary":false,"pixels":[0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,0,0,0,0,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"J","pixelcount":14,"secondary":false,"pixels":[255,255,255,255,255,255,255,0,255,255,0,0,0,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,58,255,0,0,255,0,255,0,0,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"K","pixelcount":18,"secondary":false,"pixels":[0,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,255,0,255,255,0,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"L","pixelcount":14,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,255,255,0,255,255,0,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":11,"chr":"M","pixelcount":22,"secondary":false,"pixels":[0,255,255,255,255,255,58,255,255,58,255,255,255,255,255,255,255,255,255,255,255,58,29,0,0,0,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,0,255,58,29,255,255,0,0,255,255,255,255,0,0,0,0,58,29,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":10,"chr":"N","pixelcount":26,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,0,255,255,255,0,0,255,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,0,0,255,255,255,255,255,0,255,255,0,0,0,0,0,29,58,255,255,58,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":11,"chr":"O","pixelcount":16,"secondary":false,"pixels":[255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,0,0,29,255,255,255,255,255,255,255,255,58,255,58,255,255,255,255,255,0,58,58,255,255,255,58,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,58,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"P","pixelcount":19,"secondary":false,"pixels":[0,0,255,255,0,255,0,255,255,255,0,0,255,255,255,255,0,0,0,0,0,0,0,0,0,0,255,255,0,255,255,0,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":11,"chr":"Q","pixelcount":18,"secondary":false,"pixels":[255,255,255,255,255,255,255,0,255,255,255,255,255,255,29,255,255,255,255,0,0,0,29,255,255,255,255,255,255,255,255,29,255,29,255,255,255,255,255,0,58,58,255,0,255,58,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,58,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"R","pixelcount":25,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,29,0,58,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,255,0,0,255,0,0,255,58,58,0,255,29,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":7,"chr":"S","pixelcount":14,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,58,0,0,255,255,255,255,29,255,255,29,0,255,0,29,0,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,0,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":10,"chr":"T","pixelcount":16,"secondary":false,"pixels":[255,255,255,255,255,0,0,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,0,255,255,0,255,255,0,0,0,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":10,"chr":"U","pixelcount":20,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,29,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,0,255,255,29,0,0,0,0,29,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":10,"chr":"V","pixelcount":10,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,0,58,255,255,255,0,58,255,255,255,255,255,29,255,255,255,255,255,255,255,0,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":13,"chr":"W","pixelcount":22,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,0,0,255,255,255,0,255,255,0,255,255,255,255,255,255,255,255,58,255,255,255,29,0,255,255,255,0,0,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,29,0,58,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"X","pixelcount":16,"secondary":false,"pixels":[0,255,29,255,29,255,255,255,255,0,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,29,255,255,0,255,58,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,58,0,255,255,255,0,29,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"Y","pixelcount":13,"secondary":false,"pixels":[255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,58,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,29,255,255,255,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"Z","pixelcount":18,"secondary":false,"pixels":[255,255,255,255,29,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,0,0,255,0,0,0,0,255,255,58,255,255,0,0,0,255,255,255,255,255,255,255,255,0,255,255,255,0,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"a","pixelcount":15,"secondary":false,"pixels":[255,255,255,255,58,255,0,255,255,0,255,255,0,255,255,255,255,255,255,255,255,255,255,58,0,255,255,58,255,255,0,255,255,29,255,255,255,0,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"b","pixelcount":19,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,0,0,0,0,0,0,0,0,0,255,255,255,255,255,29,255,255,0,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,0,255,255,255,255,255,255,255,255,58,255,255,255,29,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"c","pixelcount":11,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,29,255,255,0,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,29,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"d","pixelcount":19,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,0,255,255,29,255,0,0,0,0,255,0,0,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,58,255,29,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"e","pixelcount":14,"secondary":false,"pixels":[255,0,255,255,0,255,0,255,255,0,255,255,0,255,255,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,29,255,255,0,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":6,"chr":"f","pixelcount":14,"secondary":false,"pixels":[255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,0,0,58,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,58,0,0,0,255,255,255,0,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"g","pixelcount":16,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,0,0,255,255,255,58,255,255,0,255,255,255,0,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,0,0,255,255,255,29,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"h","pixelcount":19,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":4,"chr":"i","pixelcount":8,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":5,"chr":"j","pixelcount":12,"secondary":false,"pixels":[255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,29,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":7,"chr":"k","pixelcount":16,"secondary":false,"pixels":[0,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":5,"chr":"l","pixelcount":10,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":12,"chr":"m","pixelcount":24,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,255,255,29,0,255,255,255,255,255,255,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,0,255,255,255,255,0,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,0,255,255,255,255,0,255,255,255,255,58,255,255,0,255,255,255,255,255,255,255,255,0,0,0,0,0,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"n","pixelcount":16,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"o","pixelcount":16,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,255,29,255,0,58,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,58,255,255,0,255,255,255,255,29,58,255,255,255,255,255,255,255,255,255,255,58,58,255,255,255,255,255,255,255,255,255,255,58,255,255,255,58,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"p","pixelcount":17,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,0,0,0,0,0,0,255,255,255,255,255,29,255,255,0,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255]},{"width":8,"chr":"q","pixelcount":17,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,0,255,255,29,255,255,255,0,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,58,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255]},{"width":6,"chr":"r","pixelcount":9,"secondary":false,"pixels":[0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,29,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":6,"chr":"s","pixelcount":10,"secondary":false,"pixels":[255,58,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":5,"chr":"t","pixelcount":13,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,29,0,0,0,0,0,0,58,255,255,58,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255]},{"width":9,"chr":"u","pixelcount":17,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,0,0,0,0,0,29,255,255,0,255,255,0,255,255,58,255,255,255,0,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"v","pixelcount":9,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,0,255,255,255,255,255,255,29,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,58,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":12,"chr":"w","pixelcount":15,"secondary":false,"pixels":[255,29,255,255,255,255,255,255,255,255,255,0,255,255,0,0,255,255,255,29,255,255,255,255,255,255,0,255,255,255,0,255,255,255,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,0,255,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255]},{"width":8,"chr":"x","pixelcount":12,"secondary":false,"pixels":[58,255,255,255,29,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,29,255,255,29,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,58,255,58,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"y","pixelcount":13,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,0,29,0,255,255,255,255,255,255,255,29,255,255,255,255,255,255,0,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,0,29,29,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,29,255,255]},{"width":8,"chr":"z","pixelcount":16,"secondary":false,"pixels":[0,255,255,255,58,255,255,255,255,255,29,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,0,255,255,0,255,29,0,255,255,255,255,255,0,255,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"0","pixelcount":18,"secondary":false,"pixels":[255,255,255,255,255,255,255,29,255,255,255,255,255,29,255,255,255,255,255,29,0,0,29,255,255,255,255,255,29,255,29,0,255,0,255,0,255,255,0,29,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,29,0,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":7,"chr":"1","pixelcount":15,"secondary":false,"pixels":[0,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0]},{"width":8,"chr":"2","pixelcount":13,"secondary":false,"pixels":[255,255,255,255,58,255,255,58,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,0,0,255,0,255,58,0,255,255,0,255,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"3","pixelcount":13,"secondary":false,"pixels":[255,255,255,0,255,255,255,0,29,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,0,255,0,0,255,0,255,255,255,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"4","pixelcount":20,"secondary":false,"pixels":[255,0,255,255,0,255,0,255,0,0,0,0,0,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,255,0,0,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,58,255,255,255,29,255,255,255,255,255,255,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":8,"chr":"5","pixelcount":14,"secondary":false,"pixels":[255,255,255,0,255,255,255,0,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,0,255,0,0,255,0,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,58,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"6","pixelcount":18,"secondary":false,"pixels":[255,255,255,29,255,255,255,0,255,255,255,255,255,0,0,255,255,255,255,255,29,0,0,255,255,255,255,255,255,255,58,29,255,0,255,255,255,255,58,0,0,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,29,255]},{"width":9,"chr":"7","pixelcount":10,"secondary":false,"pixels":[255,255,255,255,0,255,255,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,0,255,255,0,255,255,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"8","pixelcount":18,"secondary":false,"pixels":[255,255,255,0,255,255,255,255,255,255,0,255,255,29,0,255,255,255,0,255,255,255,0,0,255,255,255,255,0,255,0,0,255,0,255,29,0,255,58,29,255,255,255,255,255,255,255,255,255,255,58,255,255,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"9","pixelcount":19,"secondary":false,"pixels":[255,255,255,255,29,255,0,255,255,255,255,255,255,58,255,255,255,255,29,0,29,255,255,255,255,255,29,0,0,255,0,0,255,29,255,29,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,29,255,255,58,0,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":6,"chr":"-","pixelcount":3,"secondary":true,"pixels":[255,0,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":4,"chr":".","pixelcount":1,"secondary":true,"pixels":[0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":4,"chr":",","pixelcount":1,"secondary":true,"pixels":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":4,"chr":"\'","pixelcount":1,"secondary":true,"pixels":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":4,"chr":"(","pixelcount":7,"secondary":false,"pixels":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,0,0,0,58,255,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":4,"chr":")","pixelcount":7,"secondary":false,"pixels":[255,0,58,255,255,255,255,255,255,255,255,255,255,255,255,255,58,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255]},{"width":9,"chr":"&","pixelcount":17,"secondary":false,"pixels":[255,255,255,0,255,255,255,255,255,255,0,0,0,255,255,255,255,255,0,255,255,255,0,0,255,255,255,255,0,255,0,0,255,0,255,255,255,29,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,0,255,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":6,"chr":"/","pixelcount":4,"secondary":true,"pixels":[255,255,0,58,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":9,"chr":"+","pixelcount":13,"secondary":true,"pixels":[255,0,255,255,0,255,0,255,255,0,255,255,0,0,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},{"width":10,"chr":"#","pixelcount":23,"secondary":false,"pixels":[255,255,0,0,255,255,255,255,255,255,0,0,255,255,0,255,255,255,255,29,255,255,255,0,255,255,255,0,255,255,255,255,255,255,255,255,58,0,255,0,255,255,255,255,255,255,0,255,255,255,58,255,255,58,255,255,0,255,255,255,255,0,255,255,255,0,0,255,255,255,255,255,255,255,255,255,255,0,0,255,0,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,58]}],"width":13,"spacewidth":3,"shadow":false,"shadowcheck":false,"height":13,"basey":9}'));
}

TooltipReader.maxw = 400;
TooltipReader.maxh = 350;
TooltipReader.offsetx = -10;
TooltipReader.offsety = -10;
function TooltipReader() {
	var me = this;

	this.farTooltip = false;//Tooltips are further away when interacting with inventory items
	this.lookabove = true;//check for tooltips going up when near the bottom of the screen
	this.trackinactive = true;//keep tracking when rs isn't active

	this.tracking = false;

	var trackcallback = null;
	var trackinterval = null;

	this.track = function (callback, interval) {
		if (!interval) { interval = 30; }
		me.stopTrack();
		trackinterval = setInterval(trackTick, interval);
		trackcallback = callback;
		me.tracking = true;
	}
	this.stopTrack = function () {
		if (trackinterval) { clearInterval(trackinterval); }
		trackinterval = null;
		me.tracking = false;
	}
	var trackTick = function () {
		var dir = 1;
		if (!me.trackinactive) {
			if (!alt1.rsActive) { return; }
			if (alt1.mousePosition == -1) { return; }
		}
		var found = TooltipReader.checkPossible(null, null, false, me.farTooltip);
		if (me.lookabove && !found && a1lib.mousePosition().y > alt1.rsHeight - TooltipReader.maxh) {
			found = TooltipReader.checkPossible(null, null, true, me.farTooltip);
			dir = -1;
		}
		var r = null;
		if (found) { r = TooltipReader.read(dir); }
		trackcallback(r);
	}
}

TooltipReader.drawOverlay = function (tooltip, ignoregroup) {
	if (!ignoregroup) {
		alt1.overLayFreezeGroup("pc_tooltipread");
		alt1.overLaySetGroupZIndex("pc_tooltipread", 1);
		alt1.overLayClearGroup("pc_tooltipread");
		alt1.overLaySetGroup("pc_tooltipread");
	}
	if (tooltip) {
		var col = a1lib.mixcolor(0, 0, 0);
		for (var a = -4; a < tooltip.area.h + 4; a += 20) {
			var y1 = tooltip.area.y + a;
			var y2 = Math.min(y1 + 20, tooltip.area.y + tooltip.area.h + 4);
			alt1.overLayRect(col, tooltip.area.x - 4, y1, tooltip.area.w + 8, y2 - y1, 400, Math.ceil((y2 - y1) / 2));
		}
	}
	if (!ignoregroup) {
		alt1.overLayRefreshGroup("pc_tooltipread");
	}
}

//very fast check to see if a tooltip might exist
//set up to true to check for tooltips above the mouse instead of under
TooltipReader.checkPossible = function (buf, pos, up,far) {
	var mousepos = a1lib.mousePosition();
	if (!buf) { buf = a1lib.getregion(mousepos.x, mousepos.y + (up ? -1 : 1) * (far ? 37 : (up ? 32 : 28)), 5, 5); }
	if (!buf) { return false; }
	var data = buf.data;
	var blacks = 0;
	for (var i = 0; i < data.length; i += 4) {
		if (data[i] == 0 && data[i + 1] == 0 && data[i + 2] == 0) { blacks++ }
	}
	return blacks > data.length / 4 / 2;
}

TooltipReader.getCaptArea = function (dir, mousepos) {
	if (!mousepos) { mousepos = a1lib.mousePosition(); }

	var captarea = {};
	captarea.w = TooltipReader.maxw;
	captarea.x = Math.min(mousepos.x - Math.floor(TooltipReader.maxw / 2), alt1.rsWidth - TooltipReader.maxw);
	if (!dir) {
		if (mousepos.y + TooltipReader.offsety + TooltipReader.maxh > alt1.rsHeight) {
			captarea.y = mousepos.y - TooltipReader.offsety - TooltipReader.maxh;
			captarea.h = alt1.rsHeight - captarea.y;
		}
		else {
			captarea.y = mousepos.y + TooltipReader.offsety;
			captarea.h = TooltipReader.maxh;
		}
	}
	else {
		captarea.h = TooltipReader.maxh;
		captarea.y = mousepos.y + (dir == -1 ? -TooltipReader.offsety - TooltipReader.maxh : TooltipReader.offsety);
	}
	return captarea;
}

TooltipReader.readImage = function (img, mouseAbs, dir) {
	var area = TooltipReader.getCaptArea(dir, mouseAbs);
	//make sure we don't try to capture something that isn't in the img
	if (area.x < img.x) { area.w -= img.x - area.x; area.x = img.x; }
	if (area.y < img.y) { area.h -= img.y - area.y; area.y = img.y; }
	if (area.w > img.width) { area.w = img.width; }
	if (area.h > img.height) { area.h = img.height; }
	if (area.x + area.w > img.x + img.width) { area.w = img.x + img.width - area.x; }
	if (area.y + area.h > img.y + img.height) { area.h = img.y + img.height - area.y; }

	var buffer = img.toData(area.x, area.y, area.w, area.h);

	var cx = mouseAbs.x - img.x;
	var cy = mouseAbs.y - img.y + 20 * dir;

	var rect = false;
	while (cx >= 0 && cx < buffer.width && cy >= 0 && cy < buffer.height) {
		var i = 4 * cx + 4 * buffer.width * cy;
		if (buffer.data[i] == 0 && buffer.data[i + 1] == 0 && buffer.data[i + 2] == 0) {
			rect = TooltipReader.attemptFill(buffer, cx, cy, dir);
			if (typeof rect == "object") { break; }
		}
		cy += dir;
	}

	if (typeof rect != "object") { return null; }

	var uncertainx = rect.x + rect.w + img.x >= alt1.rsWidth;
	var mousepos = {
		x: (uncertainx ? mouseAbs.x : img.x + rect.x + Math.floor(rect.w / 2)),
		y: img.y + rect.y + (dir == 1 ? -26 : +rect.h + 4),
		uncertainx: uncertainx,
	};
	
	return {
		area: { x: rect.x + img.x, y: rect.y + img.y, w: rect.w, h: rect.h },
		mousepos: mousepos,
		readBankItem: TooltipReader.readBankItem.b(img, rect),
		readInteraction: TooltipReader.readInteraction.b(img, rect)
	};
}

TooltipReader.read = function (dir) {
	if (!dir) { dir = 1; }//TODO find actual dir
	var mousepos = a1lib.mousePosition();
	var captarea = TooltipReader.getCaptArea(dir, mousepos);
	var img = a1lib.bindregion(captarea.x, captarea.y, captarea.w, captarea.h);
	if (!img) { return;}
	if (dir) { return TooltipReader.readImage(img, mousepos, dir); }
	else { return TooltipReader.readImage(img, mousepos, 1) || TooltipReader.readImage(img, mousepos, -1); }
}

TooltipReader.readBankItem = function (img, area) {
	var readrules = '{"fontname":"largefont","budget":150,"allowmulticol":false,"backwards":true,"colors":[' + a1lib.mixcolor(255, 152, 31) + ']}';
	var line1 = null;
	var line2 = null;
	var name = "";
	for (var a = 0; a < 2; a++) {
		var wiggle = Math.round(Math.random() * 6 - 3);
		line1 = jsonDecode(alt1.bindReadStringEx(img.handle, area.x + Math.floor(area.w / 2) + 20 + 20 * a + wiggle, area.y + 14, readrules));
		if (line1 && line1.text.match(/\w/g).length >= 4) {
			name += line1.text;
			break;
		}
	}
	if (area.h > 30) {
		for (var a = 0; a < 2; a++) {
			var wiggle = Math.round(Math.random() * 6 - 3);
			line2 = jsonDecode(alt1.bindReadStringEx(img.handle, area.x + Math.floor(area.w / 2) - 20 + 20 * a+wiggle, area.y + 14 + 15, readrules));
			if (line2 && line2.text.match(/[\)\(\w)]/g).length >= 3) {
				name += " " + line2.text;
				break;
			}
		}
	}

	return name;
}

TooltipReader.readInteraction = function (img, area) {
	var readrules = {
		fontname: "largefont",
		budget: 1,
		allowmulticol: true,
		backwards: true,
		colors: [
			a1lib.mixcolor(235, 224, 188),//+-white
			a1lib.mixcolor(0, 255, 255),//interactive scenery
			a1lib.mixcolor(248, 213, 107),//memb item
			a1lib.mixcolor(184, 209, 209),//nonmemb item
			a1lib.mixcolor(255, 255, 0),//npc
		]
	};
	var rulestr = JSON.stringify(readrules);

	var lines = jsonDecode(alt1.bindReadStringEx(img.handle, area.x + 12, area.y + 14, rulestr));
	return lines;
}

TooltipReader.searchBuffer = function (buffer, x, y, w, h) {
	if (x == null) { x = 0; y = 0; w = buffer.width; h = buffer.height; }
	var xsteps = Math.ceil(w / 100);
	var data = buffer.data;
	for (var a = 0; a <= xsteps; a++) {
		var cx = x + Math.round((w - 1) / xsteps * a);
		for (var cy = y; cy < y + h; cy++) {
			var i = 4 * cx + 4 * buffer.width * cy;

			if (data[i] == 0 && data[i + 1] == 0 && data[i + 2] == 0) {
				var r = TooltipReader.attemptFill(buffer, cx, cy, -1);
				if (typeof r == "object") { return r; }
				if (r == "badimg") { return null; }
			}
		}
	}
	return null;
}

TooltipReader.attemptFill = function (buf, x, y, dir) {
	var x1, y1, x2, y2;

	var dir = [1, dir];

	//scan in oposite x dir until nonblack pixel is found
	for (x1 = x; x1 >= 0 && x1 < buf.width; x1 -= dir[0]) {
		var i = 4 * x1 + 4 * buf.width * y;
		if (buf.data[i] == 0 && buf.data[i + 1] == 0 && buf.data[i + 2] == 0) { continue; }
		break;
	}
	x1 += dir[0];
	if (x1 == 0) {
		return "badimg";
	}

	//scan in oposite y dir until nonblack pixel is found
	for (y1 = y; y1 >= 0 && y1 < buf.height; y1 -= dir[1]) {
		var i = 4 * x + 4 * buf.width * y1;
		if (buf.data[i] == 0 && buf.data[i + 1] == 0 && buf.data[i + 2] == 0) { continue; }
		break;
	}
	y1 += dir[1];
	if (dir[1] == 1 ? y1 == 0 : y1 == buf.height - 1) {
		return "badimg";
	}

	//scan in x dir from known max y to find 2nd x
	for (x2 = x1; x2 >= 0 && x2 < buf.width; x2 += dir[0]) {
		var i = 4 * x2 + 4 * buf.width * y1;
		if (buf.data[i] == 0 && buf.data[i + 1] == 0 && buf.data[i + 2] == 0) { continue; }
		break;
	}
	x2 -= dir[0];

	//scan in y dir from known max x to find 2nd y
	for (y2 = y1; y2 >= 0 && y2 < buf.height; y2 += dir[1]) {
		var i = 4 * x1 + 4 * buf.width * y2;
		if (buf.data[i] == 0 && buf.data[i + 1] == 0 && buf.data[i + 2] == 0) { continue; }
		break;
	}
	y2 -= dir[1];

	if (Math.min(x1, x2) == 0 && Math.max(x1, x2) == buf.width) { return "notfound"; }
	if (Math.min(y1, y2) == 0 && Math.max(y1, y2) == buf.height) { return "notfound"; }
	if (Math.abs(x1 - x2) < 50 || Math.abs(y1 - y2) < 20) { return "notfound"; }
	return { x: Math.min(x1, x2), y: Math.min(y1, y2), w: Math.abs(x1 - x2) + 1, h: Math.abs(y1 - y2) + 1 };
}

